<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Busca Mensagens - Governo de Mato Grosso</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --gov-blue: #004a87;
            --gov-green: #00a859;
            --light-gray: #f0f2f5;
            --text-color: #333;
        }

        body {
            font-family: 'Open Sans', sans-serif;
            background-color: var(--light-gray);
            margin: 0;
            padding: 0;
            color: var(--text-color);
        }

        .govbr-bar {
            background-color: #f8f8f8;
            padding: 5px 0;
            border-bottom: 2px solid var(--gov-green);
        }
        .govbr-bar-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .govbr-bar a {
            font-weight: bold;
            text-decoration: none;
            color: var(--gov-blue);
        }

        header {
            background: linear-gradient(to right, var(--gov-blue), #003366);
            color: white;
            padding: 20px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }

        .header-logo {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-logo img {
            height: 60px;
        }

        .header-title h1 {
            margin: 0;
            font-size: 1.8em;
            font-weight: 700;
        }
        .header-title p {
            margin: 0;
            font-size: 1em;
        }

        .header-search {
            flex-grow: 1;
            min-width: 300px;
            max-width: 500px;
        }

        .search-box {
            display: flex;
            gap: 0;
        }

        input[type="text"] {
            flex: 1;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 5px 0 0 5px;
            font-size: 16px;
            transition: border-color 0.3s;
            border-right: none;
        }

        input[type="text"]:focus {
            border-color: var(--gov-green);
            outline: none;
        }

        .search-box button {
            padding: 12px 20px;
            background-color: var(--gov-green);
            color: white;
            border: none;
            border-radius: 0 5px 5px 0;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .search-box button:hover {
            background-color: #008748;
        }

        .search-box button svg {
            width: 20px;
            height: 20px;
        }

        .container {
            max-width: 900px;
            margin: 20px auto;
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        #resultados { margin-top: 20px; }
        #status { text-align: center; color: #666; margin-bottom: 20px; font-weight: bold; }

        .card {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-left: 5px solid var(--gov-blue);
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 5px;
            transition: box-shadow 0.3s;
        }

        .card:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .card p { margin: 8px 0; }
        .label { font-weight: bold; color: #333; }

        .pagination { display: flex; justify-content: center; align-items: center; gap: 15px; margin-top: 25px; }
        .pagination button { background-color: var(--gov-blue); color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; padding: 10px 15px; transition: background-color 0.3s; }
        .pagination button:hover { background-color: #003366; }
        .pagination button:disabled { background-color: #ccc; cursor: not-allowed; }
        .page-info { font-size: 16px; color: #555; font-weight: bold; }

        footer {
            background-color: var(--gov-blue);
            color: white;
            padding: 30px 20px;
            margin-top: 40px;
            text-align: center;
        }

        .footer-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .footer-logo {
            height: 50px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>

<div class="govbr-bar">
    <div class="govbr-bar-container">
        <a href="https://www.gov.br/pt-br" target="_blank">gov.br</a>
    </div>
</div>

<header>
    <div class="header-logo">
        <img src="https://www.mt.gov.br/storage/webfiles/imagens/2022/04/29/1651259389-logo-governo-mt-branca.png" alt="Logo Governo de Mato Grosso">
        <div class="header-title">
            <h1>Governo de Mato Grosso</h1>
            <p>Sistema de Busca de Mensagens</p>
        </div>
    </div>
    <div class="header-search">
        <div class="search-box">
            <input type="text" id="campoBusca" placeholder="Digite o que deseja pesquisar..." onkeypress="handleEnter(event)">
            <button onclick="iniciarBusca()" aria-label="Pesquisar">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" width="24px" height="24px"><path d="M0 0h24v24H0z" fill="none"/><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
            </button>
        </div>
    </div>
</header>

<main class="container">
    <div id="status">Digite um termo e pressione Enter ou clique em Pesquisar.</div>
    <div id="resultados"></div>
    <div id="paginacao"></div>
</main>

<footer>
    <div class="footer-container">
        <img src="https://www.mt.gov.br/storage/webfiles/imagens/2022/04/29/1651259389-logo-governo-mt-branca.png" alt="Logo Governo de Mato Grosso" class="footer-logo">
        <p>&copy; 2025 - Todos os direitos reservados</p>
        <p>Desenvolvido para o Governo do Estado de Mato Grosso</p>
    </div>
</footer>

<script>
    let termoAtual = '';
    let paginaAtual = 1;
    let totalPaginas = 0;

    function handleEnter(e) {
        if (e.key === 'Enter') {
            iniciarBusca();
        }
    }

    function iniciarBusca() {
        termoAtual = document.getElementById('campoBusca').value;
        paginaAtual = 1;
        if (!termoAtual) {
            document.getElementById('resultados').innerHTML = '';
            document.getElementById('status').innerHTML = 'Digite um termo e pressione Enter ou clique em Pesquisar.';
            document.getElementById('paginacao').innerHTML = '';
            return;
        }
        pesquisar(paginaAtual);
    }

    async function pesquisar(pagina) {
        const divRes = document.getElementById('resultados');
        const divStatus = document.getElementById('status');
        const divPaginacao = document.getElementById('paginacao');
        
        divRes.innerHTML = '';
        divStatus.innerHTML = 'Buscando...';
        divPaginacao.innerHTML = '';

        try {
            const response = await fetch(`/api/busca?q=${encodeURIComponent(termoAtual)}&pagina=${pagina}`);
            const data = await response.json();

            paginaAtual = data.pagina;
            totalPaginas = data.total_paginas;

            if (data.total_resultados === 0) {
                divStatus.innerHTML = 'Nenhum resultado encontrado para "' + termoAtual + '".';
                return;
            }

            divStatus.innerHTML = `Exibindo ${data.resultados.length} de ${data.total_resultados} resultados.`;

            data.resultados.forEach(item => {
                divRes.innerHTML += criarCard(item);
            });

            renderPaginacao();

        } catch (error) {
            console.error('Erro na busca:', error);
            divStatus.innerHTML = '<p style="color:red">Erro ao conectar com o servidor.</p>';
        }
    }

    function criarCard(item) {
        const nome = item.creator ? item.creator.name : (item.nome || 'Não informado');
        const dataOriginal = item.created_date || null;
        let dataFormatada = 'Data não informada';
        if (dataOriginal) {
            const dataObj = new Date(dataOriginal);
            dataFormatada = dataObj.toLocaleString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' });
        }
        
        const textoMensagem = (item.text || 'Mensagem vazia').replace(/\n/g, '<br>');

        return `
            <div class="card">
                <p><span class="label">NOME:</span> ${nome}</p>
                <p><span class="label">DATA:</span> ${dataFormatada}</p>
                <p><span class="label">MENSAGEM:</span></p>
                <div>${textoMensagem}</div>
            </div>
        `;
    }

    function renderPaginacao() {
        const divPaginacao = document.getElementById('paginacao');
        if (totalPaginas <= 1) {
            divPaginacao.innerHTML = '';
            return;
        }

        divPaginacao.innerHTML = `
            <div class="pagination">
                <button onclick="mudarPagina(paginaAtual - 1)" ${paginaAtual === 1 ? 'disabled' : ''}>Anterior</button>
                <span class="page-info">Página ${paginaAtual} de ${totalPaginas}</span>
                <button onclick="mudarPagina(paginaAtual + 1)" ${paginaAtual >= totalPaginas ? 'disabled' : ''}>Próxima</button>
            </div>
        `;
    }

    function mudarPagina(novaPagina) {
        if (novaPagina >= 1 && novaPagina <= totalPaginas) {
            pesquisar(novaPagina);
        }
    }
</script>

</body>
</html>